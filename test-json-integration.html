<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اختبار ربط ملفات JSON</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
        }
        .product-card {
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            background: #f9f9f9;
        }
        .product-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 5px;
        }
        .search-box {
            margin: 20px 0;
        }
        .filter-section {
            background: #e9ecef;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-left: 10px;
        }
        .status-success { background-color: #28a745; }
        .status-error { background-color: #dc3545; }
        .status-loading { background-color: #ffc107; }
    </style>
</head>
<body>
    <div class="container my-5">
        <h1 class="text-center mb-5">اختبار ربط ملفات JSON</h1>
        
        <!-- اختبار الاتصال -->
        <div class="test-section">
            <h3>اختبار الاتصال <span id="connection-status" class="status-indicator status-loading"></span></h3>
            <button class="btn btn-primary" onclick="testConnection()">اختبار الاتصال</button>
            <div id="connection-results" class="mt-3"></div>
        </div>

        <!-- اختبار تحميل البيانات -->
        <div class="test-section">
            <h3>اختبار تحميل البيانات</h3>
            <div class="row">
                <div class="col-md-3">
                    <button class="btn btn-success w-100 mb-2" onclick="loadCategoryData('chairs')">تحميل الكراسي</button>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-info w-100 mb-2" onclick="loadCategoryData('sofas')">تحميل الأرائك</button>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-warning w-100 mb-2" onclick="loadCategoryData('tables')">تحميل الطاولات</button>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-secondary w-100 mb-2" onclick="loadAllData()">تحميل الكل</button>
                </div>
            </div>
            <div id="load-results" class="mt-3"></div>
        </div>

        <!-- نظام البحث -->
        <div class="test-section">
            <h3>نظام البحث</h3>
            <div class="search-box">
                <input type="text" id="search-input" class="form-control" placeholder="ابحث عن منتج..." onkeyup="searchProducts(this.value)">
            </div>
            <div id="search-results" class="mt-3"></div>
        </div>

        <!-- فلترة المنتجات -->
        <div class="test-section">
            <h3>فلترة المنتجات</h3>
            <div class="filter-section">
                <div class="row">
                    <div class="col-md-3">
                        <label>أقل سعر:</label>
                        <input type="number" id="min-price" class="form-control" value="0">
                    </div>
                    <div class="col-md-3">
                        <label>أعلى سعر:</label>
                        <input type="number" id="max-price" class="form-control" value="10000">
                    </div>
                    <div class="col-md-3">
                        <label>الفئة:</label>
                        <select id="category-filter" class="form-control">
                            <option value="">جميع الفئات</option>
                            <option value="chairs">كراسي</option>
                            <option value="sofas">أرائك</option>
                            <option value="tables">طاولات</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label>&nbsp;</label>
                        <button class="btn btn-primary w-100" onclick="filterProducts()">فلترة</button>
                    </div>
                </div>
            </div>
            <div id="filter-results" class="mt-3"></div>
        </div>

        <!-- عرض المنتجات -->
        <div class="test-section">
            <h3>عرض المنتجات</h3>
            <div id="products-display" class="row"></div>
        </div>
    </div>

    <!-- تحميل ملفات JavaScript -->
    <script src="js/data-loader.js"></script>
    <script>
        // اختبار الاتصال
        async function testConnection() {
            const statusElement = document.getElementById('connection-status');
            const resultsElement = document.getElementById('connection-results');
            
            statusElement.className = 'status-indicator status-loading';
            resultsElement.innerHTML = '<p>جاري الاختبار...</p>';
            
            try {
                // اختبار تحميل ملف الكراسي
                const chairsResponse = await fetch('./data/chairs.json');
                const chairs = await chairsResponse.json();
                
                // اختبار تحميل الملف الشامل
                const allResponse = await fetch('./data/products.json');
                const allData = await allResponse.json();
                
                statusElement.className = 'status-indicator status-success';
                resultsElement.innerHTML = `
                    <div class="alert alert-success">
                        <h5>✅ تم الاختبار بنجاح!</h5>
                        <p><strong>الكراسي:</strong> ${chairs.length} منتج</p>
                        <p><strong>إجمالي المنتجات:</strong> ${allData.metadata.totalProducts} منتج</p>
                        <p><strong>آخر تحديث:</strong> ${allData.metadata.lastUpdated}</p>
                    </div>
                `;
            } catch (error) {
                statusElement.className = 'status-indicator status-error';
                resultsElement.innerHTML = `
                    <div class="alert alert-danger">
                        <h5>❌ فشل الاختبار</h5>
                        <p><strong>الخطأ:</strong> ${error.message}</p>
                        <p>تأكد من تشغيل خادم محلي (Live Server)</p>
                    </div>
                `;
            }
        }

        // تحميل بيانات فئة معينة
        async function loadCategoryData(category) {
            const resultsElement = document.getElementById('load-results');
            resultsElement.innerHTML = '<p>جاري التحميل...</p>';
            
            try {
                const data = await dataLoader.loadCategoryData(category);
                resultsElement.innerHTML = `
                    <div class="alert alert-info">
                        <h5>تم تحميل ${category} بنجاح</h5>
                        <p><strong>عدد المنتجات:</strong> ${data.length}</p>
                        <p><strong>أول منتج:</strong> ${data[0]?.name || 'غير متوفر'}</p>
                    </div>
                `;
                
                // عرض المنتجات
                displayProducts(data);
            } catch (error) {
                resultsElement.innerHTML = `
                    <div class="alert alert-danger">
                        <h5>خطأ في التحميل</h5>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // تحميل جميع البيانات
        async function loadAllData() {
            const resultsElement = document.getElementById('load-results');
            resultsElement.innerHTML = '<p>جاري التحميل...</p>';
            
            try {
                const data = await dataLoader.loadAllData();
                resultsElement.innerHTML = `
                    <div class="alert alert-success">
                        <h5>تم تحميل جميع البيانات بنجاح</h5>
                        <p><strong>إجمالي المنتجات:</strong> ${data.metadata.totalProducts}</p>
                        <p><strong>الفئات:</strong> ${Object.keys(data.categories).join(', ')}</p>
                    </div>
                `;
            } catch (error) {
                resultsElement.innerHTML = `
                    <div class="alert alert-danger">
                        <h5>خطأ في التحميل</h5>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // البحث في المنتجات
        async function searchProducts(query) {
            const resultsElement = document.getElementById('search-results');
            
            if (query.length < 2) {
                resultsElement.innerHTML = '';
                return;
            }
            
            try {
                const results = await dataLoader.searchProducts(query);
                
                if (results.length === 0) {
                    resultsElement.innerHTML = '<p class="text-muted">لم يتم العثور على نتائج</p>';
                    return;
                }
                
                let html = `<h5>نتائج البحث (${results.length}):</h5>`;
                results.forEach(product => {
                    html += `
                        <div class="product-card">
                            <h6>${product.name}</h6>
                            <p class="text-muted">السعر: ${product.price || 'غير محدد'} جنيه</p>
                        </div>
                    `;
                });
                
                resultsElement.innerHTML = html;
            } catch (error) {
                resultsElement.innerHTML = `<p class="text-danger">خطأ في البحث: ${error.message}</p>`;
            }
        }

        // فلترة المنتجات
        async function filterProducts() {
            const minPrice = parseInt(document.getElementById('min-price').value);
            const maxPrice = parseInt(document.getElementById('max-price').value);
            const category = document.getElementById('category-filter').value;
            
            const resultsElement = document.getElementById('filter-results');
            resultsElement.innerHTML = '<p>جاري الفلترة...</p>';
            
            try {
                const results = await dataLoader.filterByPrice(minPrice, maxPrice, category);
                
                if (results.length === 0) {
                    resultsElement.innerHTML = '<p class="text-muted">لم يتم العثور على منتجات تطابق المعايير</p>';
                    return;
                }
                
                let html = `<h5>المنتجات المفلترة (${results.length}):</h5>`;
                results.forEach(product => {
                    html += `
                        <div class="product-card">
                            <h6>${product.name}</h6>
                            <p class="text-muted">السعر: ${product.price} جنيه</p>
                        </div>
                    `;
                });
                
                resultsElement.innerHTML = html;
            } catch (error) {
                resultsElement.innerHTML = `<p class="text-danger">خطأ في الفلترة: ${error.message}</p>`;
            }
        }

        // عرض المنتجات
        function displayProducts(products) {
            const displayElement = document.getElementById('products-display');
            displayElement.innerHTML = '';
            
            products.slice(0, 8).forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'col-md-3 mb-3';
                productCard.innerHTML = `
                    <div class="card">
                        <img src="${product.link || product.image}" class="card-img-top" alt="${product.name}" style="height: 200px; object-fit: cover;">
                        <div class="card-body">
                            <h6 class="card-title">${product.name}</h6>
                            <p class="card-text">السعر: ${product.price || 'غير محدد'} جنيه</p>
                        </div>
                    </div>
                `;
                displayElement.appendChild(productCard);
            });
        }

        // تشغيل اختبار الاتصال عند تحميل الصفحة
        window.addEventListener('load', () => {
            testConnection();
        });
    </script>
</body>
</html>
